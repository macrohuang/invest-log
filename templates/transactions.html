{% extends "base.html" %}

{% block title %}Transactions - Invest Log{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Transactions</h1>
    <div class="header-info">
        <span class="total-count">Total: {{ total_count }} records</span>
        <a href="/add" class="btn">+ Add Transaction</a>
    </div>
</div>

<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Symbol</th>
            <th>Type</th>
            <th>Asset</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
            <th>Currency</th>
            <th>Account</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for t in transactions %}
        <tr>
            <td>{{ t.transaction_date }}</td>
            <td><strong>{{ t.symbol }}</strong></td>
            <td><span class="badge badge-{{ t.transaction_type|lower }}">{{ t.transaction_type }}</span></td>
            <td><span class="badge badge-asset-{{ t.asset_type or 'stock' }}">{{ t.asset_type or 'stock' }}</span></td>
            <td>{{ "%.4f"|format(t.quantity) }}</td>
            <td>{{ "%.2f"|format(t.price) }}</td>
            <td>{{ "%.2f"|format(t.total_amount) }}</td>
            <td>{{ t.currency or 'CNY' }}</td>
            <td>{{ t.account_id }}</td>
            <td>
                <button class="btn-delete" onclick="deleteTransaction({{ t.id }})">Delete</button>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="10" class="empty">No transactions yet. <a href="/add">Add one</a></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if total_pages > 1 %}
<div class="pagination">
    <div class="pagination-info">
        Page {{ current_page }} of {{ total_pages }}
    </div>
    <div class="pagination-controls">
        {% if current_page > 1 %}
        <a href="/transactions?page=1" class="page-link">&laquo; First</a>
        <a href="/transactions?page={{ current_page - 1 }}" class="page-link">&lsaquo; Prev</a>
        {% endif %}
        
        {% for p in range(1, total_pages + 1) %}
            {% if p >= current_page - 2 and p <= current_page + 2 %}
                {% if p == current_page %}
                <span class="page-link active">{{ p }}</span>
                {% else %}
                <a href="/transactions?page={{ p }}" class="page-link">{{ p }}</a>
                {% endif %}
            {% endif %}
        {% endfor %}
        
        {% if current_page < total_pages %}
        <a href="/transactions?page={{ current_page + 1 }}" class="page-link">Next &rsaquo;</a>
        <a href="/transactions?page={{ total_pages }}" class="page-link">Last &raquo;</a>
        {% endif %}
    </div>
</div>
{% endif %}

<script>
async function deleteTransaction(id) {
    if (!confirm('Delete this transaction?')) return;
    const res = await fetch(`/api/transactions/${id}`, { method: 'DELETE' });
    if (res.ok) location.reload();
    else alert('Failed to delete');
}
</script>
{% endblock %}
