{% extends "base.html" %}

{% block title %}{{ symbol }} - Invest Log{% endblock %}

{% block content %}
<div class="symbol-header">
    <div>
        <a href="/holdings" class="back-link">← Back to Holdings</a>
        <h1>{{ symbol }}</h1>
        <span class="currency-tag">{{ currency }}</span>
        {% if account_id %}
        <span class="currency-tag">Account: {{ account_name or account_id }}</span>
        {% endif %}
    </div>
</div>

{% if holding %}
<div class="holding-summary">
    <div class="summary-item">
        <div class="summary-label">Total Shares</div>
        <div class="summary-value text-right">{{ holding.total_shares|format_currency }}</div>
    </div>
    <div class="summary-item">
        <div class="summary-label">Avg Cost</div>
        <div class="summary-value text-right">
            {% if holding.asset_type == 'cash' %}
            <span class="text-muted">-</span>
            {% else %}
            {{ holding.avg_cost|format_currency }}
            {% endif %}
        </div>
    </div>
    <div class="summary-item">
        <div class="summary-label">Total Value</div>
        <div class="summary-value highlight text-right">
            {% if currency == 'CNY' %}¥{% elif currency == 'USD' %}${% else %}HK${% endif %}{{ holding.total_cost|format_currency }}
        </div>
    </div>
    <div class="summary-item">
        <div class="summary-label">Asset Type</div>
        <div class="summary-value">{{ asset_type_labels.get(holding.asset_type, '股票') }}</div>
    </div>
</div>

<div class="adjust-section">
    <h3>Adjust Value</h3>
    <form method="POST" action="/symbol/{{ symbol }}/adjust" class="adjust-form">
        <input type="hidden" name="currency" value="{{ currency }}">
        <input type="hidden" name="account_id" value="{{ holding.account_id }}">
        <input type="hidden" name="asset_type" value="{{ holding.asset_type }}">
        <div class="form-row">
            <div class="form-group">
                <label for="new_value">New Total Value</label>
                <input type="number" id="new_value" name="new_value" step="0.01" 
                       value="{{ holding.total_cost }}" required>
            </div>
            <div class="form-group">
                <label for="notes">Notes (optional)</label>
                <input type="text" id="notes" name="notes" placeholder="Reason for adjustment">
            </div>
            <div class="form-group">
                <button type="submit" class="btn">Adjust</button>
            </div>
        </div>
    </form>
</div>
{% else %}
<div class="empty-state">
    <p>No holding found for {{ symbol }} in {{ currency }}.</p>
</div>
{% endif %}

<div class="transactions-section">
    <div class="section-header">
        <h2>Transaction History</h2>
        <div class="year-filter">
            {% for y in years %}
            <a href="/symbol/{{ symbol }}?currency={{ currency }}&year={{ y }}{% if account_id %}&account_id={{ account_id }}{% endif %}" 
               class="year-btn {% if y == selected_year %}active{% endif %}">{{ y }}</a>
            {% endfor %}
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Price</th>
                <th class="text-right">Total</th>
                <th>Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transactions %}
            <tr>
                <td>{{ t.transaction_date }}</td>
                <td><span class="badge badge-{{ t.transaction_type|lower }}">{{ t.transaction_type }}</span></td>
                <td class="text-right">{{ t.quantity|format_currency }}</td>
                <td class="text-right">{{ t.price|format_currency }}</td>
                <td class="text-right">{{ t.total_amount|format_currency }}</td>
                <td>{{ t.notes or '-' }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="empty">No transactions in {{ selected_year }}.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
